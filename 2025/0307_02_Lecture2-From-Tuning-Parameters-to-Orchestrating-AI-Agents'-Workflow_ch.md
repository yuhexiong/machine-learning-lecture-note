# 第二講 從調參數到調 AI Agent 的工作流程

完整課程大綱請參考 [Machine Learning 2025](https://course.ntu.edu.tw/courses/113-2/41735)  
筆記為以下課程 （Hung-yi Lee YouTube）  
(1) [【生成式AI時代下的機器學習(2025)】第二講：一堂課搞懂 AI Agent 的原理 (AI如何透過經驗調整行為、使用工具和做計劃)](https://www.youtube.com/watch?v=M2Yg1kwPpts&list=PLJV_el3uVTsNZEFAdQsDeOdzAaHTca2Gi&index=2)


## AI Agent

人類不提供明確的行為、步驟或指令，而是只給予一個**目標**  
AI 會自行思考如何達成這個目標

AI 不斷重複以下循環：

目標 → 觀察（observation 1）→ 採取行動（action 1） → 觀察（observation 2）→ … → 直到達成目標

這本質上就是一種**接龍式的過程**。  
這個過程中**不包含模型訓練**，純粹是**模型的應用**。


## 使用 LLM 執行 AI Agent 的優勢

### 1. 行動能力（以下棋為例）

- **傳統 Agent（如 AlphaGo）**：  
  預先定義好有限的動作空間，只能在棋盤上的指定位置下棋

- **LLM Agent**：  
  行為幾乎**無限多樣**

### 2. 優化能力（以 AI 程式員為例）

- **傳統 Agent**：  
  必須定義一個 reward function（例如程式能否 compile），這個 reward 是主觀的且需要人工調整

- **LLM Agent**：  
  可以**直接閱讀 log** 並從中推理


## 回合制互動 vs 真實世界互動

- 概念上：  
  觀察 → 行動 → 觀察 → 行動

- 真實情況：  
  在一個行動還沒完成之前就可能出現新的**觀察**  
  例如**語音對話**中，人可能在回應尚未結束時就插話


## AI Agent 的關鍵能力

### 1. 根據經驗調整行為

- **回饋等於觀察**  
  → 可據此產生下一個行動

- 當接龍過長時，AI 必須**回顧所有過去的觀察與行動**

為了解決此問題，AI 採用以下方式：

#### （1）記憶讀取
- 將資訊儲存在 Agent 的記憶中
- 使用檢索式方法，只取出與當前問題**相關的記憶**
- 行動由「**相關記憶**」與「**當前觀察**」共同決定

*目前的語言模型幾乎無法從負面回饋中獲益*

#### （2）選擇性儲存記憶
- AI 會自問：  
  *這件事重要到值得記住嗎？*
- 僅將**重要資訊**儲存進記憶中

#### （3）反思
- 對記憶重新整理  
- 產生**新想法**  
- 建立**知識圖譜**


### 2. 使用工具（Function Call）

AI Agent 可以透過呼叫各種外部工具來補強自己的能力，像是搜尋、執行程式或與其他 AI 協作。

#### 工具類型範例
1. 搜尋引擎  
2. 程式執行器  
3. 其他 AI 模型  

#### Prompt 的優先順序
- **System Prompt**：用來告訴模型如何使用工具（優先順序高）
- **User Prompt**：使用者的提問（優先順序低）

#### 工具的使用流程
- 模型會先**產生文字**（如程式碼）
- 開發者須設定若該文字符合特定格式或條件，就會**觸發對應工具的執行**

#### 工具過多時的解法：檢索式選擇
- 將工具的說明存入 Agent 的記憶中
- 當需要使用工具時，先檢索出**與當前任務最相關的工具說明**
- 再根據這些資訊選擇最適合的工具

#### 模型可自建工具
- 模型可根據任務需要**自行撰寫程式碼來建立新工具**
- 寫好的工具會**儲存進記憶中**，方便後續重複使用

#### 工具錯誤的處理機制
- 模型具備基本判斷力，會嘗試根據內外部知識判斷問題原因
- 當外部資訊與內部知識衝突時，模型更傾向相信：
  - 與**內部知識相近**的外部資訊
  - **由其他模型撰寫**的內容，而非人類撰寫
  - **較新的內容**（根據 metadata 判斷）
  - **排版清晰、模板美觀**的文件

#### 限制與風險
- **所有資料都正確** ≠ **模型的回答正確**
- **模型執行行動的效率**也不一定最佳


### 3. 規劃能力

#### 目標導向的規劃流程
- 可透過詢問模型：「若要達成某目標，需要哪些計畫？」
- 模型會記錄計畫內容，後續的回答會依照這些計畫進行。

#### 計畫擬訂範例
- 計畫的基本形式如下：  
  採取行動（action 1）→ 採取行動（action 2）→ 採取行動（action 3）→ … → 達成目標

#### 初始流程
- 目標  
→ 觀察（observation 1）  
→ 擬訂計畫（plan）  
→ 執行行動（action 1）  
→ 觀察（observation 2）：若與預期不符，則重新擬訂計畫

#### 計畫更新方式
- 當觀察結果（observation）與預期不同時，需重新評估
- 擬訂新的計畫如下：  
  採取行動（action 2'）→ 採取行動（action 3'）→ … → 達成目標

#### 更新後的流程
- 目標 → 觀察 → 擬訂計畫 → 執行行動  
→ 若觀察結果偏離預期 → 更新計畫 → 繼續行動



#### 強化規劃能力的方法

Tree Search（樹狀搜尋）：透過樹狀結構探索可能行動路徑的方式，常用於決策與規劃。

- 實際執行型：在真實環境中執行每個動作  
缺點：執行成本高、有些動作無法回溯、現實操作不便

- 模擬型：在模擬環境中試探可能路徑  

優化方式:  
(1) 篩選低機率方案    
(2) 建立 World Model（環境模型）：補足模型對環境理解的不足 
